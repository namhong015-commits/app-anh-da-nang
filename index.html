<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI T·∫°o ·∫£nh t·ª´ m√¥ t·∫£</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:960px;margin:40px auto;padding:0 16px}
    h1{margin:0 0 16px}
    .row{display:grid;grid-template-columns:1fr 160px 120px auto;gap:12px;align-items:start}
    textarea{width:100%;height:110px;padding:10px;font-size:14px}
    select,input,button{height:42px;font-size:14px;padding:0 10px}
    button{cursor:pointer}
    #result{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
    .card{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff}
    .card img{width:100%;display:block}
    .card .cta{display:flex;gap:8px;padding:10px;border-top:1px solid #eee}
    .muted{opacity:.7}
  </style>
</head>
<body>
  <h1>AI T·∫°o ·∫£nh t·ª´ m√¥ t·∫£</h1>

  <div class="row">
    <textarea id="prompt" placeholder="M√¥ t·∫£ b·ª©c ·∫£nh..."></textarea>

    <select id="size" title="K√≠ch th∆∞·ªõc">
      <option value="1024x1024" selected>1024√ó1024</option>
      <option value="1024x1536">1024√ó1536 (d·ªçc)</option>
      <option value="1536x1024">1536√ó1024 (ngang)</option>
      <option value="auto">auto</option>
    </select>

    <input id="count" type="number" min="1" max="4" value="1" title="S·ªë ·∫£nh" />

    <button id="btn-generate" data-action="generate" onclick="generate()">üöÄ T·∫°o ·∫£nh</button>
  </div>

  <div id="result" class="muted">Ch∆∞a c√≥ k·∫øt qu·∫£.</div>

  <script>
    async function generate() {
      const prompt = document.getElementById('prompt')?.value?.trim();
      const size   = document.getElementById('size')?.value || '1024x1024';
      const n      = parseInt(document.getElementById('count')?.value || '1', 10);

      if (!prompt) {
        alert('Vui l√≤ng nh·∫≠p m√¥ t·∫£ b·ª©c ·∫£nh!');
        return;
      }

      const btn = document.getElementById('btn-generate') || document.querySelector('[data-action="generate"]');
      const out = document.getElementById('result') || document.querySelector('#result');

      if (out) out.innerHTML = '‚è≥ ƒêang t·∫°o ·∫£nh‚Ä¶';
      if (btn) btn.disabled = true;

      try {
        const res = await fetch('/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, size, n })
        });

        if (!res.ok) throw new Error('Request failed: ' + res.status);

        const data = await res.json();

        // K·ª≥ v·ªçng backend tr·∫£ { images: ["data:image/png;base64,...", ...] } ho·∫∑c { urls: ["https://..."] }
        const sources = data?.images || data?.urls || [];

        if (!Array.isArray(sources) || !sources.length) {
          out.innerHTML = '<div>Kh√¥ng c√≥ ·∫£nh tr·∫£ v·ªÅ.</div>';
          return;
        }

        out.classList.remove('muted');
        out.innerHTML = sources.map((src, i) => `
          <div class="card">
            <img src="${src}" alt="image ${i+1}" loading="lazy" />
            <div class="cta">
              <a href="${src}" download="image-${i+1}.png">‚¨áÔ∏è T·∫£i v·ªÅ</a>
              <a href="${src}" target="_blank" rel="noopener">üîç M·ªü ·∫£nh</a>
            </div>
          </div>
        `).join('');
      } catch (err) {
        console.error(err);
        if (out) out.innerHTML = '<div style="color:#b91c1c">L·ªói t·∫°o ·∫£nh: ' + (err?.message || 'Unknown') + '</div>';
      } finally {
        if (btn) btn.disabled = false;
      }
    }
  </script>
</body>
</html>
