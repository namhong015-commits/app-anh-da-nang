<script>
async function generate() {
  const prompt = document.getElementById('prompt').value.trim();
  const size   = document.getElementById('size').value;   // 1024x1024 / 1024x1536 / 1536x1024 / auto
  const n      = parseInt(document.getElementById('count').value || '1', 10);

  if (!prompt) {
    alert('Vui lòng nhập mô tả bức ảnh');
    return;
  }

  const btn = document.getElementById('btn-generate');
  btn.disabled = true;

  try {
    const res = await fetch('/generate', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ prompt, size, n })
    });

    const data = await res.json();

    if (!res.ok) {
      // Hiện lỗi ra màn hình
      throw new Error(data.error || JSON.stringify(data));
    }

    // Server có thể trả 1 url hoặc mảng urls
    const urls = Array.isArray(data.urls) ? data.urls : [data.url];

    const out = document.getElementById('result');
    out.innerHTML = '';
    urls.forEach(u => {
      const img = new Image();
      img.src = u;
      img.loading = 'lazy';
      img.className = 'w-full rounded-lg shadow';
      out.appendChild(img);
    });

  } catch (err) {
    alert('Lỗi: ' + err.message);
  } finally {
    btn.disabled = false;
  }
}
</script>
